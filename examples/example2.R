source("copasi_funs.R")

stopifnot(!is.null(CRootContainer_getRoot()))
# create a datamodel
dataModel <- CRootContainer_addDatamodel()
stopifnot(DataModelVector_size(CRootContainer_getDatamodelList()) == 1)
# the only argument to the main routine should be the name of a CPS file
args <- "examples/brusselator.cps"
if (length(args) == 1) {
    filename <- args[1]
    # load the model without progress report
   
    # I have no clue how exception handling in R works
    tryCatch(CDataModel_loadModel(dataModel,filename), error = function(e) {
      write(paste("Error while loading the model from file named \"" , filename , "\"."), stderr())
      quit(save = "default", status = 1, runLast = TRUE)
    } )

    model <- CDataModel_getModel(dataModel)
    stopifnot(!is.null(model))
    cat('Model statistics for model "' , CDataObject_getObjectName(model) , '".\n', sep="")

    # output number and names of all compartments
    iMax <- CompartmentVector_size(CModel_getCompartments(model))
    cat("Number of Compartments: " , iMax, "\n", sep="")
    cat("Compartments: \n")
    i <- 0
    while ( i < iMax) {
        compartment <- CModel_getCompartment(model,i)
        stopifnot(!is.null(compartment))
        cat("    " , CDataObject_getObjectName(compartment), "\n", sep = "")
        i <- i + 1
    }
    # output number and names of all metabolites
    iMax <- MetabVector_size(CModel_getMetabolites(model))
    cat("Number of Metabolites: " , iMax, "\n", sep = "")
    cat("Metabolites: \n")
    i <- 0
    while (i < iMax) {
        metab <- CModel_getMetabolite(model,i)
        stopifnot(!is.null(metab))
        cat("    " , CDataObject_getObjectName(metab), "\n", sep="")
        i <- i + 1
    }
    # output number and names of all reactions
    iMax <- ReactionVector_size(CModel_getReactions(model))
    cat("Number of Reactions: " , iMax, "\n", sep = "")
    cat("Reactions: \n")
    i <- 0
    while ( i < iMax) {
        reaction <- CModel_getReaction(model,i)
        stopifnot(!is.null(reaction))
        cat("    " , CDataObject_getObjectName(reaction) , "\n", sep="")
        i <- i + 1
    }
} else {
    write( "Usage: example2 CPSFILE", stderr())
    quit(save = "default", status = 1, runLast = TRUE)
}


