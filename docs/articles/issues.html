<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Issues • CoRC</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">CoRC</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/examples.html">Examples</a>
    </li>
    <li>
      <a href="../articles/issues.html">Issues</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jpahle/CoRC">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Issues</h1>
                        <h4 class="author">Jonas Förster &amp; Jürgen Pahle</h4>
            
            <h4 class="date">2017-07-29</h4>
          </div>

    
    
<div class="contents">
<div id="initial-setup" class="section level2">
<h2 class="hasAnchor">
<a href="#initial-setup" class="anchor"></a>Initial Setup</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(CoRC)</code></pre></div>
</div>
<div id="checking-validity-of-quantity-unit-doesnt-work" class="section level2">
<h2 class="hasAnchor">
<a href="#checking-validity-of-quantity-unit-doesnt-work" class="anchor"></a>Checking validity of quantity unit doesn’t work</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">CUnit &lt;-<span class="st"> </span>CoRC:::CUnit</code></pre></div>
<p>The CUnit class can be used for testing if user specified input is valid</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ms &lt;-<span class="st"> </span><span class="kw">CUnit</span>(<span class="st">"ms"</span>)
s &lt;-<span class="st"> </span><span class="kw">CUnit</span>(<span class="st">"ms * 1e3"</span>)
mmol &lt;-<span class="st"> </span><span class="kw">CUnit</span>(<span class="st">"mmol"</span>)
mol &lt;-<span class="st"> </span><span class="kw">CUnit</span>(<span class="st">"mmol * 1e3"</span>)

ms$<span class="kw">buildExpression</span>()
<span class="co">#&gt; NULL</span>
s$<span class="kw">buildExpression</span>()
<span class="co">#&gt; NULL</span>
mmol$<span class="kw">buildExpression</span>()
<span class="co">#&gt; NULL</span>
mol$<span class="kw">buildExpression</span>()
<span class="co">#&gt; NULL</span></code></pre></div>
<p>CUnit$getExpression(“<type>”) shows what Copasi makes of the input</type></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  ms$<span class="kw">getExpression</span>()
<span class="co">#&gt; [1] "ms"</span>
  s$<span class="kw">getExpression</span>()
<span class="co">#&gt; [1] "kms"</span>
  mmol$<span class="kw">getExpression</span>()
<span class="co">#&gt; [1] "mmol"</span>
  mol$<span class="kw">getExpression</span>()
<span class="co">#&gt; [1] "kmmol"</span></code></pre></div>
<p>CUnit$isUnitType(“<type>”) will return useful information on validity for all but “quantity”</type></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s$<span class="kw">isUnitType</span>(<span class="st">"time"</span>)
<span class="co">#&gt; [1] TRUE</span>
s$<span class="kw">isUnitType</span>(<span class="st">"quantity"</span>)
<span class="co">#&gt; [1] FALSE</span>

mol$<span class="kw">isUnitType</span>(<span class="st">"time"</span>)
<span class="co">#&gt; [1] FALSE</span>
mol$<span class="kw">isUnitType</span>(<span class="st">"quantity"</span>)
<span class="co">#&gt; [1] FALSE</span>
mol$<span class="kw">isUnitType</span>(<span class="st">"volume"</span>)
<span class="co">#&gt; [1] FALSE</span>
mol$<span class="kw">isUnitType</span>(<span class="st">"area"</span>)
<span class="co">#&gt; [1] FALSE</span>
mol$<span class="kw">isUnitType</span>(<span class="st">"length"</span>)
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
</div>
<div id="objectdisplayname-seems-more-apropriate-than-cn" class="section level2">
<h2 class="hasAnchor">
<a href="#objectdisplayname-seems-more-apropriate-than-cn" class="anchor"></a>ObjectDisplayName seems more apropriate than CN</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/loadExamples.html">loadExamples</a></span>(<span class="dv">1</span>)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; # A copasi model reference:</span>
<span class="co">#&gt; Model name: "The Brusselator"</span>
<span class="co">#&gt; @ref is set to: &lt;pointer: 0x7fb39f843740&gt;</span>
<span class="co">#&gt; Number of compartments: 1</span>
<span class="co">#&gt; Number of species: 6</span>
<span class="co">#&gt; Number of reactions: 4</span>
<span class="co">#&gt; </span>
<span class="kw"><a href="../reference/species.html">species</a></span>(<span class="st">"X"</span>)
<span class="co">#&gt; [1] "CN=Root,Model=The Brusselator,Vector=Compartments[compartment],Vector=Metabolites[X]"</span>
<span class="kw"><a href="../reference/species.html">species</a></span>(<span class="st">"X"</span>, <span class="st">"InitialConcentration"</span>)
<span class="co">#&gt; [1] "CN=Root,Model=The Brusselator,Vector=Compartments[compartment],Vector=Metabolites[X],Reference=InitialConcentration"</span></code></pre></div>
<p>When a species is identified I have to return the CommonName as reference. In this use case, returning the ObjectDisplayNames seems more friendly to the user. Especially because this is the way it is presented in the GUI too.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">CoRC:::<span class="kw">cn_to_object</span>(<span class="kw"><a href="../reference/species.html">species</a></span>(<span class="st">"X"</span>), <span class="dt">datamodel =</span> <span class="kw"><a href="../reference/getCurrentModel.html">getCurrentModel</a></span>())[[<span class="dv">1</span>]]$<span class="kw">getObjectDisplayName</span>()
<span class="co">#&gt; [1] "X"</span>
CoRC:::<span class="kw">cn_to_object</span>(<span class="kw"><a href="../reference/species.html">species</a></span>(<span class="st">"X"</span>, <span class="st">"InitialConcentration"</span>), <span class="dt">datamodel =</span> <span class="kw"><a href="../reference/getCurrentModel.html">getCurrentModel</a></span>())[[<span class="dv">1</span>]]$<span class="kw">getObjectDisplayName</span>()
<span class="co">#&gt; [1] "[X]_0"</span></code></pre></div>
<p>They should be able to accomplish the same job in uniquely identifying a reference but there are no methods to resolve from DisplayName back to an Object.</p>
</div>
<div id="reliably-setting-values" class="section level2">
<h2 class="hasAnchor">
<a href="#reliably-setting-values" class="anchor"></a>Reliably setting values</h2>
<p>I don’t understand how to consistently keep the math up to date with the values set in the model.</p>
<p>For reaction parameter, my methods are currently broken. I can set the value, but after running a task the value will be restored.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/loadExamples.html">loadExamples</a></span>(<span class="dv">1</span>)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; # A copasi model reference:</span>
<span class="co">#&gt; Model name: "The Brusselator"</span>
<span class="co">#&gt; @ref is set to: &lt;pointer: 0x7fb39f95ab60&gt;</span>
<span class="co">#&gt; Number of compartments: 1</span>
<span class="co">#&gt; Number of species: 6</span>
<span class="co">#&gt; Number of reactions: 4</span>
<span class="co">#&gt; </span>
ts1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runTimeCourse.html">runTimeCourse</a></span>()
<span class="kw"><a href="../reference/getParameters.html">getParameters</a></span>(<span class="st">"(R1).k1"</span>)$value
<span class="co">#&gt; [1] 1</span>
<span class="kw"><a href="../reference/setParameters.html">setParameters</a></span>(<span class="st">"(R1).k1"</span>, <span class="dt">value =</span> <span class="dv">99</span>)
<span class="kw"><a href="../reference/getParameters.html">getParameters</a></span>(<span class="st">"(R1).k1"</span>)$value
<span class="co">#&gt; [1] 99</span>
ts2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/runTimeCourse.html">runTimeCourse</a></span>()
<span class="kw"><a href="../reference/getParameters.html">getParameters</a></span>(<span class="st">"(R1).k1"</span>)$value
<span class="co">#&gt; [1] 1</span>
<span class="kw">identical</span>(ts1, ts2)
<span class="co">#&gt; [1] TRUE</span>
<span class="kw"><a href="../reference/unloadModel.html">unloadModel</a></span>()</code></pre></div>
<p>In this example, the following is not the right approach?:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">model</span>()$<span class="kw">updateInitialValues</span>(changedObjects)</code></pre></div>
</div>
<div id="saving--cps-loses-experimental-data" class="section level2">
<h2 class="hasAnchor">
<a href="#saving--cps-loses-experimental-data" class="anchor"></a>Saving .cps loses experimental data</h2>
<p>I commonly want to save a .cps to a tmp folder but when I do that experimental data paths will fail.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">datamodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/loadSBML.html">loadSBML</a></span>(<span class="st">"http://www.ebi.ac.uk/biomodels-main/download?mid=BIOMD0000000010"</span>)

<span class="co"># define the experiments for copasi</span>
experiment &lt;-<span class="st"> </span><span class="kw">defineExperiments</span>(
  <span class="dt">filename =</span> <span class="st">"issue_expdata"</span>,
  <span class="dt">data =</span> <span class="kw">suppressMessages</span>(<span class="kw">read_tsv</span>(<span class="st">"data/MAPKdata.txt"</span>)),
  <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">"time"</span>, <span class="st">"dependent"</span>, <span class="st">"dependent"</span>),
  <span class="dt">mapping =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="kw"><a href="../reference/species.html">species</a></span>(<span class="kw">c</span>(<span class="st">"Mos-P"</span>, <span class="st">"Erk2-P"</span>), <span class="st">"Concentration"</span>))
)

<span class="kw">addExperiments</span>(experiment)

fitproblem &lt;-<span class="st"> </span><span class="kw">as</span>(datamodel$<span class="kw">getTask</span>(<span class="st">"Parameter Estimation"</span>)$<span class="kw">getProblem</span>(), <span class="st">"_p_CFitProblem"</span>)
filenames &lt;-<span class="st"> </span>fitproblem$<span class="kw">getExperimentSet</span>()$<span class="kw">getFileNames</span>()</code></pre></div>
<p>The filenames are relative to the model and in the correct folder.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">filenames
<span class="co">#&gt; [1] "issue_expdata.txt"</span>
<span class="kw">file.exists</span>(filenames)
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>Now I will save the model into a tmp folder.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">file &lt;-<span class="st"> </span><span class="kw">tempfile</span>(<span class="dt">fileext =</span> <span class="st">".cps"</span>)
<span class="kw"><a href="../reference/saveCPS.html">saveCPS</a></span>(file)
<span class="co"># unloadModel()</span>

datamodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/loadModel.html">loadModel</a></span>(file)
fitproblem &lt;-<span class="st"> </span><span class="kw">as</span>(datamodel$<span class="kw">getTask</span>(<span class="st">"Parameter Estimation"</span>)$<span class="kw">getProblem</span>(), <span class="st">"_p_CFitProblem"</span>)
filenames &lt;-<span class="st"> </span>fitproblem$<span class="kw">getExperimentSet</span>()$<span class="kw">getFileNames</span>()</code></pre></div>
<p>The filenames are now supposedly in the folder where the .cps was saved but there they don’t exist.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">filenames
<span class="co">#&gt; [1] "/private/var/folders/4b/hp0s7q1x1dg62t1m8nn8y3mw0000gn/T/Rtmp9pABaD/issue_expdata.txt"</span>
<span class="kw">file.exists</span>(filenames)
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># unloadModel()</span>
<span class="kw">invisible</span>(<span class="kw">file.remove</span>(file, <span class="st">"issue_expdata.txt"</span>))</code></pre></div>
</div>
<div id="crashes-with-experimental-data" class="section level2">
<h2 class="hasAnchor">
<a href="#crashes-with-experimental-data" class="anchor"></a>Crashes with experimental data</h2>
<p>Running this code multiple times crashes the R session.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/loadSBML.html">loadSBML</a></span>(<span class="st">"http://www.ebi.ac.uk/biomodels-main/download?mid=BIOMD0000000010"</span>)

<span class="co"># define the experiments for copasi</span>
experiment &lt;-<span class="st"> </span><span class="kw">defineExperiments</span>(
  <span class="dt">filename =</span> <span class="st">"issue_expdata"</span>,
  <span class="dt">data =</span> <span class="kw">suppressMessages</span>(<span class="kw">read_tsv</span>(<span class="st">"data/MAPKdata.txt"</span>)),
  <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">"time"</span>, <span class="st">"dependent"</span>, <span class="st">"dependent"</span>),
  <span class="dt">mapping =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="kw"><a href="../reference/species.html">species</a></span>(<span class="kw">c</span>(<span class="st">"Mos-P"</span>, <span class="st">"Erk2-P"</span>), <span class="st">"Concentration"</span>))
)

<span class="kw">addExperiments</span>(experiment)

<span class="kw"><a href="../reference/unloadModel.html">unloadModel</a></span>()</code></pre></div>
<pre class="error"><code>Call("R_swig_delete_CExperiment", self, PACKAGE = "COPASI")
 *** caught segfault ***
address 0x0, cause 'memory not mapped'</code></pre>
<p>My approach for adding Experiments is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exp &lt;-<span class="st"> </span><span class="kw">CExperiment</span>()
experiment_set$<span class="kw">addExperiment</span>(exp)</code></pre></div>
<p>some time later the experiment might get removed by calling either of:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">CRootContainer_removeDatamodel</span>(datamodel)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">experiment_set$<span class="kw">removeExperiment</span>(<span class="dv">0</span>)</code></pre></div>
<p>Maybe R crashes some time later because SWIG does try to delete exp too?</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#initial-setup">Initial Setup</a></li>
      <li><a href="#checking-validity-of-quantity-unit-doesnt-work">Checking validity of quantity unit doesn’t work</a></li>
      <li><a href="#objectdisplayname-seems-more-apropriate-than-cn">ObjectDisplayName seems more apropriate than CN</a></li>
      <li><a href="#reliably-setting-values">Reliably setting values</a></li>
      <li><a href="#saving--cps-loses-experimental-data">Saving .cps loses experimental data</a></li>
      <li><a href="#crashes-with-experimental-data">Crashes with experimental data</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jonas Förster, Jürgen Pahle.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
