---
title: "CoRC Introduction"
author: "Jonas Förster & Jürgen Pahle"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{CoRC}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 8,
  fig.asp = 10/16,
  out.width = "100%",
  warning = FALSE,
  message = FALSE,
  error = TRUE
)
set.seed(1)
```
<img src="../man/figures/logo.svg" alt="CoRC logo" width="200" align="right"/>

# Getting started

## Initial Setup

To start, load the library.

```{r setup, results="hide"}
library(CoRC)
# optionally use this at the start of any script to verify CoRC is ready.
getCopasi(quiet = TRUE)
```

From this point on, CoRC keeps an instance of COPASI running in the background.
This instance can load up as many models as desired.

## Loading a model

Initially, no model is loaded.

```{r}
runTimeCourse()
```

You can load a model by using one of the model management commands.

```{r, eval=FALSE}
newModel()
loadModel(path)
loadModelFromString(model_string)
loadSBML(path)
loadSBMLFromString(sbml_string)
loadExamples()
```

When loading a model, the returned object is a reference to the model that will give basic information when printed.

```{r}
model <- loadSBML("http://www.ebi.ac.uk/biomodels-main/download?mid=BIOMD0000000329")
model
```

This reference can be used with most functions using the `model` argument but can also be safely ignored when working with a single model.

## Workflow

CoRC contains a plethora of functions for working with COPASI models.
The most basic ones required for common workflows are used for manipulation of model entities and running tasks.

```{r}
str(getSpecies())
```

```{r}
setSpecies("G-alpha", initial_concentration = 0.02)
timecourse <- runTimeCourse(duration = 100, intervals = 10000)
```

This enables quick definition of loops, for example to scan through various concentration values of a species.

```{r}
ga_concentrations <- 1:5

for (ga_conc in ga_concentrations) {
  setSpecies("G-alpha", initial_concentration = ga_conc)
  
  ga_state <- getSpecies("G-alpha")
  
  print(paste(
    "Current concentration:", ga_state$initial_concentration, ga_state$unit
  ))
  
  # further commands e.g.:
  # runTimecourse()
  # saveModel(paste0("ga", ga_value, ".cps"))
}
```


## CoRC data

Data generated by CoRC is returned as common R structures such as lists, data frames and matrices.
Data frames are wrapped in an equivalent structure called a [`tibble`](https://cran.r-project.org/web/packages/tibble/README.html) which behaves identical in most circumstances but gives a reasonable overview when printing.

```{r}
timecourse$result
```

It is encouraged to use the [ggplot2 package](https://cran.r-project.org/web/packages/ggplot2/index.html) for generating publication-ready plots from CoRC data.
The helper function `autoplot` can be used to quickly print timecourse data.

```{r}
library(ggplot2)
autoplot(timecourse)
```

## Final steps

Finally, a model can be saved via several model management commands.

```{r, eval=FALSE}
saveModel(filename)
saveModelToString()
saveSBML(path, level = 3, version = 1)
saveSBMLToString()
```

To free up memory, unload any loaded models or restart R.

```{r}
unloadModel(model)
unloadAllModels()
```

## Examples

Information regarding different aspects of CoRC and simple examples can be found in the articles on [model entity management](https://jpahle.github.io/CoRC/articles/entity_management.html), [task management](https://jpahle.github.io/CoRC/articles/task_management.html) and [model building](https://jpahle.github.io/CoRC/articles/model_building.html) on the CoRC website.
More sophisticated examples and case-studies illustrating further benefits of using CoRC can be found in the [examples article](https://jpahle.github.io/CoRC/articles/examples.html).
