---
title: "Copasi R API"
output: html_notebook
---

# Initial Setup for MacOS

## Initial checkout

Initial setup of the Copasi R API requires checking out the copasi-r-api repositiory at an appropriate location.
Note the following dependencies for compiling the sources:
cmake, swig

```{bash}
git clone --recursive git@github.com:jonasfoe/copasi-r-api.git
```

It is recommended to use this file with the .Rproj defined in the repository.

## Fixing Copasi source

```{bash}
cd copasi-dev/COPASI/
git apply ../fix-corefoundation-library.patch
cd ../../
```

## Compiling Copasi dependencies

```{bash}
cd copasi-dev/copasi-dependencies/
./createOSX.sh
cd ../../
```

## Compiling Copasi from source

```{bash}
cd copasi-dev/
mkdir build_copasi_r_bindings
cd build_copasi_r_bindings/
cmake -DBUILD_GUI=OFF -DBUILD_SE=OFF -DENABLE_R=ON -DCOPASI_DEPENDENCY_DIR=../copasi-dependencies/bin ../COPASI
make
cd ../../
```

# Loading the COPASI-R-API

```{r}
dyn.load(paste0("copasi-dev/build_copasi_r_bindings/copasi/bindings/R/COPASI", .Platform$dynlib.ext))
source("copasi-dev/build_copasi_r_bindings/copasi/bindings/R/COPASI.R")
cacheMetaData(1)
```

## Fixing enumeration wrappers

```{r}
enumToInteger <- function(name,type) {
    if (is.character(name)) {
        ans <- as.integer(get0(paste0(".__E__", type))[name])
        if (length(ans) == 0) {ans <- as.integer(get(paste0(".__E__", substr(type, 3, nchar(type))))[name])}
        if (is.na(ans)) {warning("enum not found ", name, " ", type)}
        ans
    }
}
  
enumFromInteger <- function(i,type) {
    itemlist <- get0(paste0(".__E__", type))
    if (length(itemlist) == 0) {itemlist <- get(paste0(".__E__", substr(type, 3, nchar(type))))}
    names(itemlist)[match(i, itemlist)]
}
```

The API is now loaded.
